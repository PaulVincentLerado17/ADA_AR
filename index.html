<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Touch Links</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.min.js"></script>
    <style>
        .clickable {
            cursor: pointer;
        }
        .clickable:hover, .clickable:active {
            opacity: 0.8 !important;
            box-shadow: 0 0 10px 3px rgba(0, 255, 0, 0.7);
        }
        /* Mobile touch area indicator */
        .clickable::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px dashed rgba(255,255,0,0.5);
            pointer-events: none;
            display: none;
        }
        .clickable:hover::after {
            display: block;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden; touch-action: none;">
    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false;"
        cursor="rayOrigin: mouse; fuse: false"
        raycaster="objects: .clickable; far: 100; near: 0.01; recursive: true"
        renderer="logarithmicDepthBuffer: true; precision: medium;">

        <!-- Marker Content -->
        <a-marker type="pattern" url="Calling_Card/logo.patt">
            <!-- Your 3D Model -->
            <a-entity gltf-model="#person" position="2.5 0 -1" scale="2 2 2"
                     animation="property: rotation; to: 0 360 0; loop: true; dur: 8000;"></a-entity>

            <!-- Touchable Link - Facebook -->
            <a-entity position="0 0.5 0" class="clickable" data-url="https://facebook.com">
                <a-plane position="0 0 0" width="0.6" height="0.6" color="#4267B2"
                        material="shader: flat; opacity: 0.7; side: double"></a-plane>
                <a-text value="Facebook" color="white" align="center" position="0 0 0.01"
                       width="1.5"></a-text>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Mobile-optimized touch handler
        AFRAME.registerComponent('touch-handler', {
            init: function () {
                const el = this.el;
                
                // Handle both mouse and touch events
                const handleClick = (evt) => {
                    evt.stopPropagation();
                    const url = el.getAttribute('data-url');
                    console.log('Tapped element with URL:', url);
                    
                    if (url) {
                        // Vibrate on mobile if supported
                        if ('vibrate' in navigator) {
                            navigator.vibrate(50);
                        }
                        
                        // Open URL with timeout to ensure it works after AR interaction
                        setTimeout(() => {
                            window.open(url, '_blank');
                        }, 300);
                    }
                };

                // Add both touch and mouse events
                el.addEventListener('click', handleClick);
                el.addEventListener('touchstart', (evt) => {
                    evt.preventDefault();
                    handleClick(evt);
                });
                
                // Visual feedback
                el.addEventListener('mousedown', () => el.setAttribute('scale', '0.95 0.95 0.95'));
                el.addEventListener('mouseup', () => el.setAttribute('scale', '1 1 1'));
                el.addEventListener('touchstart', () => el.setAttribute('scale', '0.95 0.95 0.95'));
                el.addEventListener('touchend', () => el.setAttribute('scale', '1 1 1'));
            }
        });

        // Initialize after scene loads
        document.querySelector('a-scene').addEventListener('loaded', function() {
            const clickables = document.querySelectorAll('.clickable');
            clickables.forEach(el => {
                el.setAttribute('touch-handler', '');
                console.log('Added touch handler to:', el);
            });
            
            // Adjust raycaster for mobile
            const raycaster = document.querySelector('[raycaster]');
            raycaster.setAttribute('raycaster', 'far', 20);
            raycaster.setAttribute('raycaster', 'showLine', true);
        });
    </script>
</body>
</html>